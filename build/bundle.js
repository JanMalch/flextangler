var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function i(t){t.forEach(e)}function o(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e){t.appendChild(e)}function s(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode.removeChild(t)}function c(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function h(){return u(" ")}function d(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function f(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function g(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}let m;function p(t){m=t}function w(){const t=function(){if(!m)throw new Error("Function called outside component initialization");return m}();return(e,n)=>{const i=t.$$.callbacks[e];if(i){const o=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);i.slice().forEach((e=>{e.call(t,o)}))}}}const y=[],x=[],$=[],v=[],b=Promise.resolve();let L=!1;function T(t){$.push(t)}let k=!1;const C=new Set;function E(){if(!k){k=!0;do{for(let t=0;t<y.length;t+=1){const e=y[t];p(e),_(e.$$)}for(p(null),y.length=0;x.length;)x.pop()();for(let t=0;t<$.length;t+=1){const e=$[t];C.has(e)||(C.add(e),e())}$.length=0}while(y.length);for(;v.length;)v.pop()();L=!1,k=!1,C.clear()}}function _(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(T)}}const R=new Set;function I(t,e){t&&t.i&&(R.delete(t),t.i(e))}function P(t,e,n,i){if(t&&t.o){if(R.has(t))return;R.add(t),undefined.c.push((()=>{R.delete(t),i&&(n&&t.d(1),i())})),t.o(e)}}function j(t){t&&t.c()}function q(t,n,r){const{fragment:a,on_mount:s,on_destroy:l,after_update:c}=t.$$;a&&a.m(n,r),T((()=>{const n=s.map(e).filter(o);l?l.push(...n):i(n),t.$$.on_mount=[]})),c.forEach(T)}function S(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function z(t,e){-1===t.$$.dirty[0]&&(y.push(t),L||(L=!0,b.then(E)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function F(e,o,r,a,s,c,u=[-1]){const h=m;p(e);const d=o.props||{},f=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:u,skip_bound:!1};let g=!1;if(f.ctx=r?r(e,d,((t,n,...i)=>{const o=i.length?i[0]:n;return f.ctx&&s(f.ctx[t],f.ctx[t]=o)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](o),g&&z(e,t)),n})):[],f.update(),g=!0,i(f.before_update),f.fragment=!!a&&a(f.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);f.fragment&&f.fragment.l(t),t.forEach(l)}else f.fragment&&f.fragment.c();o.intro&&I(e.$$.fragment),q(e,o.target,o.anchor),E()}p(h)}class A{$destroy(){S(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function D(t,e,n){const i=t.slice();return i[5]=e[n],i[7]=n,i}function M(t){let e,n,i;return{c(){e=c("img"),e.src!==(n=t[0][t[7]].src??void 0)&&f(e,"src",n),f(e,"alt",i=t[0][t[7]].alt+"}"),f(e,"class","svelte-10y3sb4")},m(t,n){s(t,e,n)},p(t,o){1&o&&e.src!==(n=t[0][t[7]].src??void 0)&&f(e,"src",n),1&o&&i!==(i=t[0][t[7]].alt+"}")&&f(e,"alt",i)},d(t){t&&l(e)}}}function O(t){let e,n,i,o,r,m,p,w,y,x,$,v,b=null==t[0][t[7]]?.src?`Select one ${3!==t[7]?"or more":""} image${3===t[7]?"":"s"}.`:"Swap image.",L=null!=t[0][t[7]]?.src&&M(t);function T(...e){return t[2](t[7],...e)}return{c(){e=c("div"),L&&L.c(),n=h(),i=c("label"),o=u(b),m=h(),p=c("input"),x=h(),f(i,"for",r="file-"+t[7]),f(i,"class","svelte-10y3sb4"),f(p,"id",w="file-"+t[7]),f(p,"type","file"),f(p,"accept","image/*"),p.multiple=y=3!==t[7],f(p,"class","svelte-10y3sb4"),f(e,"class","box-shadow svelte-10y3sb4")},m(t,r){s(t,e,r),L&&L.m(e,null),a(e,n),a(e,i),a(i,o),a(e,m),a(e,p),a(e,x),$||(v=d(p,"change",T),$=!0)},p(i,r){null!=(t=i)[0][t[7]]?.src?L?L.p(t,r):(L=M(t),L.c(),L.m(e,n)):L&&(L.d(1),L=null),1&r&&b!==(b=null==t[0][t[7]]?.src?`Select one ${3!==t[7]?"or more":""} image${3===t[7]?"":"s"}.`:"Swap image.")&&g(o,b)},d(t){t&&l(e),L&&L.d(),$=!1,v()}}}function B(e){let n,i={length:4},o=[];for(let t=0;t<i.length;t+=1)o[t]=O(D(e,i,t));return{c(){n=c("form");for(let t=0;t<o.length;t+=1)o[t].c();f(n,"class","svelte-10y3sb4")},m(t,e){s(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null)},p(t,[e]){if(3&e){let r;for(i={length:4},r=0;r<i.length;r+=1){const a=D(t,i,r);o[r]?o[r].p(a,e):(o[r]=O(a),o[r].c(),o[r].m(n,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=i.length}},i:t,o:t,d(t){t&&l(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(o,t)}}}function H(t,e,n){let{images:i=[]}=e;const o=w();let r=Array(4).fill(null);function a(t,e){const n=Array.from(t.target.files);r=Array(4).fill(null).map(((t,i)=>i<e||i>=e+n.length?r[i]:n[i-e])),o("filesChange",r)}return t.$$set=t=>{"images"in t&&n(0,i=t.images)},[i,a,(t,e)=>a(e,t)]}class U extends A{constructor(t){super(),F(this,t,H,B,r,{images:0})}}function N(t,e){return Object.freeze({x:t,y:e})}function W(t){return e=>t.map((t=>{return(n=t,t=>({x:n.x*t,y:n.y*t}))(e);var n}))}const G=W([N(0,0),N(1,.5),N(2,0)]);const V=W([N(0,0),N(0,1),N(1,.5)]);function Y(t,e,n,i){null!=i?t.drawImage(e,i.x,i.y,i.width,i.height,n.x,n.y,n.width,n.height):t.drawImage(e,n.x,n.y,n.width,n.height)}function J(t,e){t.moveTo(e[0].x,e[0].y);for(let n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y)}function K(t,e,n,i,o){t.save(),t.beginPath(),J(t,e.points.map((t=>N(t.x+e.x,t.y+e.y)))),t.closePath(),t.fillStyle="#eeeeee",t.fill(),t.fillStyle="#333333",t.font="18px monospace",t.textAlign="center",t.textBaseline=i,o&&o(),t.fillText("Glue",n.x,n.y),t.restore()}function Q(t,e,n){const i=function(t){return[{x:0,y:0,points:G(t)},{x:2*t,y:0,points:G(t)},{x:4*t,y:0,points:G(t)}]}(e),o=function(t){return[{x:6*t,y:0,points:V(t)},{x:6*t,y:t,points:V(t)}]}(e);for(const e of i)K(t,e,N(e.x+e.points[1].x,(e.y+e.points[1].y)/2),"bottom");for(const e of o)K(t,e,N(e.x+e.points[1].x,e.y+e.points[1].y/2),"middle",(()=>t.translate(n/2,0)))}const X={vertical:Array(6).fill(0).map(((t,e)=>({start:N(e+1,0),end:N(e+1,e%2==0?2.5:2)}))),diagonalTLBR:[{start:N(0,1),end:N(2,2)},{start:N(0,0),end:N(4,2)},{start:N(2,0),end:N(6,2)},{start:N(4,0),end:N(6,1)}],diagonalBLTR:[{start:N(0,1),end:N(2,0)},{start:N(0,2),end:N(4,0)},{start:N(2,2),end:N(6,0)},{start:N(4,2),end:N(6,1)}]};function Z(t){t.setLineDash([5,10]),t.lineWidth=1,t.strokeStyle="#666666"}const tt=Math.sqrt(3)/4;function et(t){return Math.PI*t/180}const nt=[{relativeRectangle:{x:0,y:.5,width:.5,height:tt},rotation:(t,e)=>{const n=t.getContext("2d");n.translate(t.width/2,t.height/2),n.rotate(et(90)),n.drawImage(e,e.width/-2,e.height/-2)}},{relativeRectangle:{x:0,y:.5-tt,width:.5,height:tt},rotation:(t,e)=>{const n=t.getContext("2d");n.translate(t.width/2,t.height/2),n.rotate(et(90)),n.drawImage(e,e.width/-2,e.height/-2)}},{rotation:(t,e)=>{const n=t.getContext("2d");n.translate(0,e.width/2),n.rotate(et(-30)),n.drawImage(e,0,0)},relativeRectangle:{x:.25,y:.5-tt,width:.5,height:tt}},{rotation:(t,e)=>{const n=t.getContext("2d");n.rotate(et(-30)),n.drawImage(e,e.width/-2,0)},relativeRectangle:{x:.5,y:.5-tt,width:.5,height:tt}},{rotation:(t,e)=>{const n=t.getContext("2d");n.translate(0,t.height/2),n.rotate(et(-150)),n.drawImage(e,-1*t.height,0)},relativeRectangle:{x:.5,y:.5,width:.5,height:tt}},{rotation:(t,e)=>{const n=t.getContext("2d");n.translate(t.width,t.height/2),n.rotate(et(-150)),n.drawImage(e,0,-1*t.width)},relativeRectangle:{x:.25,y:.5,width:.5,height:tt}}];function it(t,e,n,i){const o=t.getContext("2d");o.clearRect(0,0,t.width,t.height),o.save(),function(t,e,n){t.save(),t.beginPath(),J(t,e),t.closePath(),t.clip(),n(),t.restore()}(o,n.map((e=>({x:e.x*t.width,y:e.y*t.height}))),(()=>{Y(o,e,{x:0,y:0,width:t.width,height:t.height},{x:i.x*e.naturalWidth,y:i.y*e.naturalHeight,width:i.width*e.naturalWidth,height:i.height*e.naturalHeight})})),o.restore()}function ot(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e}function rt(t,e,n,i,o){const r=ot({width:t,height:t*(2*tt)}),a=ot({height:t,width:t*(2*tt)}),s=ot({width:t,height:t});return it(r,e,n,i),function(t,e,n){const i=e.getContext("2d");i.save(),n(e,t),i.restore()}(r,a,o),function(t,e){const n=e.getContext("2d");n.save(),Y(n,t,{x:0,y:0,width:e.width,height:e.height},{x:0,y:0,width:t.width,height:t.height}),n.restore()}(a,s),s}const at=[{x:.5,y:0},{x:1,y:1},{x:0,y:1}],st=[{x:0,y:0},{x:1,y:0},{x:.5,y:1}];function lt(e){let n,i,o;return{c(){n=c("canvas"),f(n,"class","box-shadow svelte-1airipy"),f(n,"width",i=6*e[1]+e[2]),f(n,"height",o=2.5*e[1])},m(t,i){s(t,n,i),e[6](n)},p(t,[e]){6&e&&i!==(i=6*t[1]+t[2])&&f(n,"width",i),2&e&&o!==(o=2.5*t[1])&&f(n,"height",o)},i:t,o:t,d(t){t&&l(n),e[6](null)}}}function ct(t,e,n){let{drawables:i=[]}=e,{size:o}=e,{canvas:r=null}=e,{drawCuttingLines:a=!1}=e,{drawFoldingLines:s=!1}=e;const l=w();const c=({start:t,end:e})=>{h.beginPath(),h.moveTo(o*t.x,o*t.y),h.lineTo(o*e.x,o*e.y),h.stroke()};function u(t,e,n){e%2==0?0===n?h.drawImage(t,5*t.width,e*(o/2)):h.drawImage(t,(n-1)*t.width,e*(o/2)):h.drawImage(t,n*t.width,e*(o/2))}let h,d;return t.$$set=t=>{"drawables"in t&&n(3,i=t.drawables),"size"in t&&n(1,o=t.size),"canvas"in t&&n(0,r=t.canvas),"drawCuttingLines"in t&&n(4,a=t.drawCuttingLines),"drawFoldingLines"in t&&n(5,s=t.drawFoldingLines)},t.$$.update=()=>{if(1&t.$$.dirty&&n(7,h=null==r?void 0:r.getContext("2d")),2&t.$$.dirty&&n(2,d=Math.ceil(.4*o)),191&t.$$.dirty&&null!=r&&null!=h&&4===i.length&&i.every((t=>t instanceof HTMLImageElement))){h.clearRect(0,0,r.width,r.height),Q(h,o,d);const t=i.map((t=>Array(6).fill(0).map(((e,n)=>Object.assign({image:t,clippingTriangle:n%2==0?st:at},nt[n])))));for(let e=0;e<t.length;e++){const n=t[e];for(let t=0;t<nt.length;t++){const i=n[t];u(rt(o,i.image,i.clippingTriangle,i.relativeRectangle,i.rotation),e,t)}}a&&function(){h.save(),h.beginPath(),h.moveTo(0,0),h.lineTo(0,2*o),h.lineTo(o,2.5*o),h.lineTo(2*o,2*o),h.lineTo(3*o,2.5*o),h.lineTo(4*o,2*o),h.lineTo(5*o,2.5*o),h.lineTo(6*o,2*o);const t=Math.tan(et(90-63.435))*d;h.lineTo(6*o+d,2*o-t),h.lineTo(6*o+d,o+t),h.lineTo(6*o,o),h.lineTo(6*o+d,o-t),h.lineTo(6*o+d,t),h.lineTo(6*o,0),h.closePath(),Z(h),h.stroke(),h.restore()}(),s&&(h.save(),Z(h),X.vertical.forEach(c),X.diagonalTLBR.forEach(c),X.diagonalBLTR.forEach(c),h.restore()),l("finish",r)}},[r,o,d,i,a,s,function(t){x[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class ut extends A{constructor(t){super(),F(this,t,ct,lt,r,{drawables:3,size:1,canvas:0,drawCuttingLines:4,drawFoldingLines:5})}get drawables(){return this.$$.ctx[3]}set drawables(t){this.$set({drawables:t}),E()}get size(){return this.$$.ctx[1]}set size(t){this.$set({size:t}),E()}get canvas(){return this.$$.ctx[0]}set canvas(t){this.$set({canvas:t}),E()}get drawCuttingLines(){return this.$$.ctx[4]}set drawCuttingLines(t){this.$set({drawCuttingLines:t}),E()}get drawFoldingLines(){return this.$$.ctx[5]}set drawFoldingLines(t){this.$set({drawFoldingLines:t}),E()}}function ht(t){let e;return{c(){e=u("Please select 4 images before continuing.")},m(t,n){s(t,e,n)},d(t){t&&l(e)}}}function dt(t){let e,n;return{c(){e=c("strong"),e.textContent="Your template is ready!",n=h()},m(t,i){s(t,e,i),s(t,n,i)},d(t){t&&l(e),t&&l(n)}}}function ft(t){let e,n,o,r,m,p,w,y,x,$,v,b,L,T,k,C,E,_,R,z,F,A,D,M,O,B,H,N,W,G,V,Y,J,K,Q,X,Z,tt,et,nt=t[2]?"Hide":"Show";function it(t,e){return t[5]?dt:ht}p=new U({props:{images:t[3]}}),p.$on("filesChange",t[8]);let ot=it(t),rt=ot(t),at={drawables:t[4],drawCuttingLines:t[6],drawFoldingLines:t[7],size:gt};return J=new ut({props:at}),t[14](J),J.$on("finish",t[9]),{c(){e=c("p"),e.textContent=`The app will then transform your images to fit the flextangle template. Please\n  note that the cutting is based on the largest possible hexagon in the center\n  of each image. To make sure you have the desired outcome, you can upload\n  squared images that are at least\n  ${gt}×${gt}px in size.`,n=h(),o=c("p"),o.textContent="Simply select four images with the boxes below. If you select more than one\n  file, they are put into the subsequent boxes.",r=h(),m=c("section"),j(p.$$.fragment),w=h(),y=c("section"),x=c("label"),$=c("input"),v=u("\n    Draw cutting lines"),b=h(),L=c("label"),T=c("input"),k=u("\n    Draw folding lines"),C=h(),E=c("section"),_=c("p"),rt.c(),R=c("br"),z=u("\n    Download the image or verify the outcome in the preview beforehand."),F=h(),A=c("section"),D=c("button"),M=u("Download template"),B=h(),H=c("button"),N=u(nt),W=u("\n    preview"),V=h(),Y=c("section"),j(J.$$.fragment),Q=h(),X=c("section"),X.innerHTML='<p>Print the template and follow the\n    <a href="https://i.imgur.com/9Fmn6Da.mp4" rel="noopener">cutting and folding\n      instructions</a>.<br/>\n    Lastly make sure you share this website with your family and friends, if you\n    like it.</p>',f(m,"class","svelte-1jrm2q"),f($,"type","checkbox"),f(T,"type","checkbox"),f(y,"class","svelte-1jrm2q"),f(E,"class","svelte-1jrm2q"),f(D,"class","btn box-shadow svelte-1jrm2q"),D.disabled=O=!t[5],f(H,"class","btn box-shadow svelte-1jrm2q"),H.disabled=G=!t[5],f(A,"class","svelte-1jrm2q"),Y.hidden=K=!t[2],f(Y,"class","svelte-1jrm2q"),f(X,"class","svelte-1jrm2q")},m(i,l){s(i,e,l),s(i,n,l),s(i,o,l),s(i,r,l),s(i,m,l),q(p,m,null),s(i,w,l),s(i,y,l),a(y,x),a(x,$),$.checked=t[6],a(x,v),a(y,b),a(y,L),a(L,T),T.checked=t[7],a(L,k),s(i,C,l),s(i,E,l),a(E,_),rt.m(_,null),a(_,R),a(_,z),s(i,F,l),s(i,A,l),a(A,D),a(D,M),a(A,B),a(A,H),a(H,N),a(H,W),s(i,V,l),s(i,Y,l),q(J,Y,null),t[15](Y),s(i,Q,l),s(i,X,l),Z=!0,tt||(et=[d($,"change",t[12]),d(T,"change",t[13]),d(D,"click",t[11]),d(H,"click",t[10])],tt=!0)},p(t,[e]){const n={};8&e&&(n.images=t[3]),p.$set(n),64&e&&($.checked=t[6]),128&e&&(T.checked=t[7]),ot!==(ot=it(t))&&(rt.d(1),rt=ot(t),rt&&(rt.c(),rt.m(_,R))),(!Z||32&e&&O!==(O=!t[5]))&&(D.disabled=O),(!Z||4&e)&&nt!==(nt=t[2]?"Hide":"Show")&&g(N,nt),(!Z||32&e&&G!==(G=!t[5]))&&(H.disabled=G);const i={};16&e&&(i.drawables=t[4]),64&e&&(i.drawCuttingLines=t[6]),128&e&&(i.drawFoldingLines=t[7]),J.$set(i),(!Z||4&e&&K!==(K=!t[2]))&&(Y.hidden=K)},i(t){Z||(I(p.$$.fragment,t),I(J.$$.fragment,t),Z=!0)},o(t){P(p.$$.fragment,t),P(J.$$.fragment,t),Z=!1},d(a){a&&l(e),a&&l(n),a&&l(o),a&&l(r),a&&l(m),S(p),a&&l(w),a&&l(y),a&&l(C),a&&l(E),rt.d(),a&&l(F),a&&l(A),a&&l(V),a&&l(Y),t[14](null),S(J),t[15](null),a&&l(Q),a&&l(X),tt=!1,i(et)}}}const gt=200;function mt(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))};let o,r,a=!1,s=[],l=[],c=!1,u=!1,h=!1;return[o,r,a,s,l,c,u,h,function({detail:t}){return i(this,void 0,void 0,(function*(){n(4,l=[]),s.forEach((t=>{null!=(null==t?void 0:t.src)&&URL.revokeObjectURL(t.src)})),n(3,s=t.map((t=>{var e;return{src:null==t?null:URL.createObjectURL(t),alt:null!==(e=null==t?void 0:t.name)&&void 0!==e?e:null}}))),n(4,l=yield Promise.all(s.map((t=>{var e,n;return n=null!==(e=null==t?void 0:t.src)&&void 0!==e?e:null,new Promise(((t,e)=>{if(null==n)return Promise.resolve(null);const i=new Image;i.addEventListener("load",(()=>t(i)),{once:!0}),i.addEventListener("error",(t=>e(t)),{once:!0}),i.src=n}))}))))}))},function(){n(5,c=!0)},function(){n(2,a=!a),a&&setTimeout((()=>o.scrollIntoView()))},function(){const t=document.createElement("a");t.download="flextangle-template.png",t.href=r.canvas.toDataURL("image/png"),t.target="_blank",t.click()},function(){u=this.checked,n(6,u)},function(){h=this.checked,n(7,h)},function(t){x[t?"unshift":"push"]((()=>{r=t,n(1,r)}))},function(t){x[t?"unshift":"push"]((()=>{o=t,n(0,o)}))}]}return new class extends A{constructor(t){super(),F(this,t,mt,ft,r,{})}}({target:document.body.querySelector("main")})}();
//# sourceMappingURL=bundle.js.map
